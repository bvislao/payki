(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{4662:(e,t,n)=>{Promise.resolve().then(n.bind(n,4927)),Promise.resolve().then(n.bind(n,9661)),Promise.resolve().then(n.t.bind(n,5763,23))},4927:(e,t,n)=>{"use strict";n.d(t,{default:()=>h});var a=n(4248),i=n(7642),r=n.n(i),s=n(9661),l=n(4564),o=n(9410);async function u(){return"serviceWorker"in navigator?await navigator.serviceWorker.register("/sw.js"):null}async function c(e,t){if(!("serviceWorker"in navigator)||!("PushManager"in window))throw Error("Push no soportado en este navegador");if("granted"!==await Notification.requestPermission())throw Error("Permiso de notificaciones denegado");let n=await navigator.serviceWorker.ready,a=await n.pushManager.getSubscription();if(a){let e=a.toJSON().keys;return await t({endpoint:a.endpoint,p256dh:e.p256dh,auth:e.auth}),!0}let i=await n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){if(!e)throw Error("VAPID public key is empty/undefined");let t=e.trim().replace(/^"+|"+$/g,"").replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/"),n=t.length%4;n&&(t+="=".repeat(4-n));let a="";try{a=atob(t)}catch(e){throw Error("Invalid VAPID public key (not Base64/Base64URL).")}let i=new Uint8Array(a.length);for(let e=0;e<a.length;e++)i[e]=a.charCodeAt(e);return i}(e)}),r=i.toJSON().keys;return await t({endpoint:i.endpoint,p256dh:r.p256dh,auth:r.auth}),!0}function d(){let{userId:e}=(0,s.A)(),[t,n]=(0,l.useState)(!1),i="BMoOo9WNPPHr_bTAO1pfRuPNEG1yBAG1iP34WSS-B-AlgIQ_mBh680P8PF5p5NCB4qzo5jpHo6EUHU1vmaCnAog",r=async()=>{let t=function(){var e;let t=[],n=window.isSecureContext||"https:"===location.protocol;n||"localhost"===location.hostname||t.push("El sitio no est\xe1 en HTTPS.");let a="serviceWorker"in navigator;a||t.push("Este navegador no soporta Service Worker.");let i="PushManager"in window;i||t.push("Este navegador no soporta la API de Push.");let r=null==(e=Notification)?void 0:e.permission;"denied"===r&&t.push("Las notificaciones est\xe1n bloqueadas para este sitio.");let s=navigator.userAgent||"",l=/iPad|iPhone|iPod/.test(s)&&!("MSStream"in window),o=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone;return l&&!o&&t.push("En iOS debes instalar la PWA en la pantalla de inicio para recibir push."),{ok:0===t.length,reasons:t,info:{isSecure:n,hasSW:a,hasPush:i,perm:r,isIOS:l,isStandalone:o}}}();if(!t.ok)return void alert("Navegador no soportado para Web Push:\n- "+t.reasons.join("\n- "));if(!e)return alert("Inicia sesi\xf3n primero");if(!i)return alert("Falta NEXT_PUBLIC_VAPID_PUBLIC_KEY");try{n(!0),await u(),await c(i,async t=>{let{endpoint:n,p256dh:a,auth:i}=t;await o.N.from("push_subscriptions").upsert({user_id:e,endpoint:n,p256dh:a,auth:i,user_agent:navigator.userAgent},{onConflict:"endpoint"})}),alert("Notificaciones activadas")}catch(e){alert(e instanceof Error?e.message:String(e))}finally{n(!1)}};return(0,a.jsx)("button",{className:"btn-outline",onClick:r,disabled:t,children:t?"Activandoâ€¦":"Activar notificaciones"})}function h(){let{userId:e,email:t,profile:n,signOut:i}=(0,s.A)();return(0,a.jsxs)("nav",{className:"container flex items-center justify-between h-14",children:[(0,a.jsx)(r(),{href:"/","aria-label":"Inicio",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("img",{src:"/logo-bg.svg",alt:"PAYKI",className:"h-7 w-auto"}),(0,a.jsx)("span",{className:"sr-only",children:"PAYKI"})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[e&&(0,a.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:["Hola ",(0,a.jsx)("b",{children:t}),"! (",(0,a.jsx)("b",{children:null==n?void 0:n.role}),")"]}),!!e&&(0,a.jsx)(d,{}),e?(0,a.jsx)("button",{className:"btn-outline",onClick:async()=>{await i(),window.location.href="/"},children:"Cerrar sesi\xf3n"}):(0,a.jsx)(r(),{className:"btn",href:"/login",children:"Login"})]})]})}},5763:()=>{},9410:(e,t,n)=>{"use strict";n.d(t,{N:()=>a});let a=(0,n(5835).createBrowserClient)("https://exyxexamvwfvwxjjfqpl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4eXhleGFtdndmdnd4ampmcXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc5MzEsImV4cCI6MjA3NDgyMzkzMX0.JW0haLRNKznqB0C5zMx9wF7_u6RTZQsD6WwgqpHHVIU")},9661:(e,t,n)=>{"use strict";n.d(t,{A:()=>o,AuthProvider:()=>l});var a=n(4248),i=n(4564),r=n(9410);let s=(0,i.createContext)(null);function l(e){let{children:t}=e,[n,l]=(0,i.useState)(null),[o,u]=(0,i.useState)(null),[c,d]=(0,i.useState)(null),[h,p]=(0,i.useState)(!0),g=async(e,t)=>{let{data:n}=await r.N.from("profiles").select("*").eq("id",e).maybeSingle();if(n)return void d(n);let{data:a,error:i}=await r.N.rpc("ensure_profile",{p_id:e,p_email:null!=t?t:""});if(i){console.error("[ensure_profile rpc] error",i),d(null);return}d(null!=a?a:null)};(0,i.useEffect)(()=>{(async()=>{var e,t,n,a,i,s;let{data:o}=await r.N.auth.getSession(),c=null!=(i=null==(t=o.session)||null==(e=t.user)?void 0:e.id)?i:null,d=null!=(s=null==(a=o.session)||null==(n=a.user)?void 0:n.email)?s:null;l(c),u(d),c&&await g(c,d),p(!1)})();let{data:e}=r.N.auth.onAuthStateChange(async(e,t)=>{var n,a,i,r;let s=null!=(i=null==t||null==(n=t.user)?void 0:n.id)?i:null,o=null!=(r=null==t||null==(a=t.user)?void 0:a.email)?r:null;l(s),u(o),s?await g(s,o):d(null)});return()=>{e.subscription.unsubscribe()}},[]);let v=async()=>{await r.N.auth.signOut()};return(0,a.jsx)(s.Provider,{value:{userId:n,email:o,profile:c,loading:h,signOut:v},children:t})}let o=()=>{let e=(0,i.useContext)(s);if(!e)throw Error("AuthProvider missing");return e}}},e=>{e.O(0,[360,835,642,647,516,358],()=>e(e.s=4662)),_N_E=e.O()}]);