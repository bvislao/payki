(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{39:(e,r,t)=>{Promise.resolve().then(t.bind(t,9523)),Promise.resolve().then(t.bind(t,4927)),Promise.resolve().then(t.bind(t,8787)),Promise.resolve().then(t.bind(t,1235)),Promise.resolve().then(t.bind(t,9661)),Promise.resolve().then(t.t.bind(t,5763,23))},1235:(e,r,t)=>{"use strict";t.d(r,{default:()=>i});var a=t(4248),n=t(8299);function i(){return(0,a.jsx)(n.l$,{position:"top-center",toastOptions:{duration:3e3,style:{fontSize:"0.9rem",borderRadius:"0.75rem",background:"var(--toast-bg)",color:"var(--toast-fg)"},success:{iconTheme:{primary:"#10b981",secondary:"white"}},error:{iconTheme:{primary:"#ef4444",secondary:"white"}}}})}},4927:(e,r,t)=>{"use strict";t.d(r,{default:()=>f});var a=t(4248),n=t(7642),i=t.n(n),s=t(5519),l=t(9661),o=t(4564),c=t(9410);async function u(){return"serviceWorker"in navigator?await navigator.serviceWorker.register("/sw.js"):null}async function d(e,r){if(!("serviceWorker"in navigator)||!("PushManager"in window))throw Error("Push no soportado en este navegador");if("granted"!==await Notification.requestPermission())throw Error("Permiso de notificaciones denegado");let t=await navigator.serviceWorker.ready,a=await t.pushManager.getSubscription();if(a){let e=a.toJSON().keys;return await r({endpoint:a.endpoint,p256dh:e.p256dh,auth:e.auth}),!0}let n=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){if(!e)throw Error("VAPID public key is empty/undefined");let r=e.trim().replace(/^"+|"+$/g,"").replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/"),t=r.length%4;t&&(r+="=".repeat(4-t));let a="";try{a=atob(r)}catch(e){throw Error("Invalid VAPID public key (not Base64/Base64URL).")}let n=new Uint8Array(a.length);for(let e=0;e<a.length;e++)n[e]=a.charCodeAt(e);return n}(e)}),i=n.toJSON().keys;return await r({endpoint:n.endpoint,p256dh:i.p256dh,auth:i.auth}),!0}var h=t(8299);function m(){let{userId:e}=(0,l.A)(),[r,t]=(0,o.useState)(!1),n="BMoOo9WNPPHr_bTAO1pfRuPNEG1yBAG1iP34WSS-B-AlgIQ_mBh680P8PF5p5NCB4qzo5jpHo6EUHU1vmaCnAog",i=async()=>{let r=function(){var e;let r=[],t=window.isSecureContext||"https:"===location.protocol;t||"localhost"===location.hostname||r.push("El sitio no est\xe1 en HTTPS.");let a="serviceWorker"in navigator;a||r.push("Este navegador no soporta Service Worker.");let n="PushManager"in window;n||r.push("Este navegador no soporta la API de Push.");let i=null==(e=Notification)?void 0:e.permission;"denied"===i&&r.push("Las notificaciones est\xe1n bloqueadas para este sitio.");let s=navigator.userAgent||"",l=/iPad|iPhone|iPod/.test(s)&&!("MSStream"in window),o=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone;return l&&!o&&r.push("En iOS debes instalar la PWA en la pantalla de inicio para recibir push."),{ok:0===r.length,reasons:r,info:{isSecure:t,hasSW:a,hasPush:n,perm:i,isIOS:l,isStandalone:o}}}();if(!r.ok)return void(0,h.Ay)("Navegador no soportado para Web Push:\n- "+r.reasons.join("\n- "));if(!e)return(0,h.Ay)("Inicia sesi\xf3n primero");if(!n)return(0,h.Ay)("Falta NEXT_PUBLIC_VAPID_PUBLIC_KEY");try{t(!0),await u(),await d(n,async r=>{let{endpoint:t,p256dh:a,auth:n}=r;await c.N.from("push_subscriptions").upsert({user_id:e,endpoint:t,p256dh:a,auth:n,user_agent:navigator.userAgent},{onConflict:"endpoint"})}),(0,h.Ay)("Notificaciones activadas")}catch(e){h.Ay.error(e instanceof Error?e.message:String(e))}finally{t(!1)}};return(0,a.jsx)("button",{className:"btn-outline",onClick:i,disabled:r,children:r?"ACt…":"Act Not"})}let p=[{href:"/user",label:"Usuario",roles:["passenger","admin"]},{href:"/driver",label:"Conductor",roles:["driver","admin"]},{href:"/admin",label:"Admin",roles:["admin"]}];function g(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.filter(Boolean).join(" ")}function f(){var e;let{userId:r,email:t,profile:n,signOut:c}=(0,l.A)(),u=(0,s.usePathname)(),[d,h]=(0,o.useState)(!1);(0,o.useEffect)(()=>{h(!1)},[u]);let f=null!=(e=null==n?void 0:n.role)?e:null,b=p.filter(e=>!e.roles||f&&e.roles.includes(f));return(0,a.jsxs)("nav",{className:"container flex items-center justify-between h-14",children:[(0,a.jsxs)(i(),{href:"/","aria-label":"Inicio",className:"flex items-center gap-2 shrink-0",children:[(0,a.jsx)("img",{src:"/logo-bg.svg",alt:"PAYKI",className:"h-7 w-auto"}),(0,a.jsx)("span",{className:"sr-only",children:"PAYKI"})]}),(0,a.jsxs)("div",{className:"hidden md:flex items-center gap-2",children:[b.map(e=>(0,a.jsx)(i(),{href:e.href,className:g("px-3 py-1.5 rounded-xl text-sm transition-colors",u.startsWith(e.href)?"bg-emerald-600 text-white":"hover:bg-gray-100 dark:hover:bg-gray-800"),children:e.label},e.href)),r&&(0,a.jsx)(m,{}),r?(0,a.jsx)("button",{className:"btn-outline",onClick:async()=>{await c(),window.location.href="/"},"aria-label":"Cerrar sesi\xf3n",children:"Cerrar sesi\xf3n"}):(0,a.jsx)(i(),{className:"btn",href:"/login",children:"Login"})]}),(0,a.jsx)("div",{className:"hidden md:block ml-3",children:r&&(0,a.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:["Hola ",(0,a.jsx)("b",{className:"truncate max-w-[220px] inline-block align-bottom",children:t})," \xb7 ",(0,a.jsx)("b",{children:f})]})}),(0,a.jsxs)("button",{className:"md:hidden inline-flex items-center justify-center w-10 h-10 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>h(e=>!e),"aria-expanded":d,"aria-controls":"mobile-menu","aria-label":"Abrir men\xfa",children:[(0,a.jsx)("span",{className:"sr-only",children:"Abrir men\xfa"}),(0,a.jsx)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",className:"stroke-current",children:(0,a.jsx)("path",{d:"M4 7h16M4 12h16M4 17h16",strokeWidth:"1.8",strokeLinecap:"round"})})]}),(0,a.jsx)("div",{id:"mobile-menu",className:g("md:hidden absolute left-0 right-0 top-14 z-40 border-b border-gray-200/60 dark:border-gray-800 bg-white/95 dark:bg-gray-950/95 backdrop-blur",d?"block":"hidden"),children:(0,a.jsxs)("div",{className:"container py-3 flex flex-col gap-2",children:[r&&(0,a.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-300 px-2",children:["Hola ",(0,a.jsx)("b",{children:t})," \xb7 ",(0,a.jsx)("b",{children:f})]}),b.map(e=>(0,a.jsx)(i(),{href:e.href,className:g("px-3 py-2 rounded-xl text-sm",u.startsWith(e.href)?"bg-emerald-600 text-white":"hover:bg-gray-100 dark:hover:bg-gray-800"),children:e.label},e.href)),(0,a.jsxs)("div",{className:"flex items-center gap-2 px-2",children:[r&&(0,a.jsx)(m,{}),r?(0,a.jsx)("button",{className:"btn-outline w-full",onClick:async()=>{await c(),window.location.href="/"},children:"Cerrar sesi\xf3n"}):(0,a.jsx)(i(),{className:"btn w-full",href:"/login",children:"Login"})]})]})})]})}},5519:(e,r,t)=>{"use strict";var a=t(2455);t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}})},5763:()=>{},8787:(e,r,t)=>{"use strict";t.d(r,{default:()=>n});var a=t(4564);function n(){return(0,a.useEffect)(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js",{scope:"/"}).catch(console.error)},[]),null}},9410:(e,r,t)=>{"use strict";t.d(r,{N:()=>a});let a=(0,t(5835).createBrowserClient)("https://exyxexamvwfvwxjjfqpl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4eXhleGFtdndmdnd4ampmcXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc5MzEsImV4cCI6MjA3NDgyMzkzMX0.JW0haLRNKznqB0C5zMx9wF7_u6RTZQsD6WwgqpHHVIU")},9523:(e,r,t)=>{"use strict";t.d(r,{default:()=>s});var a=t(4248),n=t(7642),i=t.n(n);function s(){return(0,a.jsxs)("footer",{className:"container py-8 text-xs text-center text-gray-500",children:["Hecho con ",(0,a.jsx)("span",{"aria-label":"amor",title:"amor",children:"❤"})," —"," ",(0,a.jsx)(i(),{href:"https://github.com/bvislao/payki",className:"underline hover:opacity-80",target:"_blank",rel:"noopener noreferrer",children:"C\xf3digo GitHub"}),"  "," \xa9 ",new Date().getFullYear()," PAYKI"]})}},9661:(e,r,t)=>{"use strict";t.d(r,{A:()=>o,AuthProvider:()=>l});var a=t(4248),n=t(4564),i=t(9410);let s=(0,n.createContext)(null);function l(e){let{children:r}=e,[t,l]=(0,n.useState)(null),[o,c]=(0,n.useState)(null),[u,d]=(0,n.useState)(null),[h,m]=(0,n.useState)(!0),p=async(e,r)=>{let{data:t}=await i.N.from("profiles").select("*").eq("id",e).maybeSingle();if(t)return void d(t);let{data:a,error:n}=await i.N.rpc("ensure_profile",{p_id:e,p_email:null!=r?r:""});if(n){console.error("[ensure_profile rpc] error",n),d(null);return}d(null!=a?a:null)};(0,n.useEffect)(()=>{(async()=>{var e,r,t,a,n,s;let{data:o}=await i.N.auth.getSession(),u=null!=(n=null==(r=o.session)||null==(e=r.user)?void 0:e.id)?n:null,d=null!=(s=null==(a=o.session)||null==(t=a.user)?void 0:t.email)?s:null;l(u),c(d),u&&await p(u,d),m(!1)})();let{data:e}=i.N.auth.onAuthStateChange(async(e,r)=>{var t,a,n,i;let s=null!=(n=null==r||null==(t=r.user)?void 0:t.id)?n:null,o=null!=(i=null==r||null==(a=r.user)?void 0:a.email)?i:null;l(s),c(o),s?await p(s,o):d(null)});return()=>{e.subscription.unsubscribe()}},[]);let g=async()=>{await i.N.auth.signOut()};return(0,a.jsx)(s.Provider,{value:{userId:t,email:o,profile:u,loading:h,signOut:g},children:r})}let o=()=>{let e=(0,n.useContext)(s);if(!e)throw Error("AuthProvider missing");return e}}},e=>{e.O(0,[360,835,299,642,647,516,358],()=>e(e.s=39)),_N_E=e.O()}]);