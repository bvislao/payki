(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[422],{451:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});var l=s(4248),r=s(9661);function t(e){let{role:a,children:s}=e,{userId:t,profile:n,loading:i}=(0,r.A)();return i?(0,l.jsx)("div",{className:"card p-6",children:"Cargandoâ€¦"}):t?n?"passenger"===a&&"passenger"!==n.role?(0,l.jsx)("div",{className:"card p-6",children:"Solo para pasajeros."}):"driver"===a&&"driver"!==n.role?(0,l.jsx)("div",{className:"card p-6",children:"Solo para conductores."}):"admin"===a&&"admin"!==n.role?(0,l.jsx)("div",{className:"card p-6",children:"Solo admins."}):(0,l.jsx)(l.Fragment,{children:s}):(0,l.jsx)("div",{className:"card p-6",children:"Perfil no encontrado."}):(0,l.jsx)("div",{className:"card p-6",children:"Inicia sesi\xf3n."})}},1046:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>o});var l=s(4248),r=s(4564),t=s(451),n=s(7642),i=s.n(n),c=s(9661),d=s(9410);async function u(e){let{data:a}=await d.N.from("transactions").select("id,type,amount,ts,meta,raw_base,fare_code").eq("passenger_id",e).order("ts",{ascending:!1}).limit(50),s=(a||[]).map(e=>({id:e.id,type:e.type,label:"topup"===e.type?"Recarga":"Viaje ".concat(e.fare_code||""),amount:Number(e.amount),date:new Date(e.ts).toLocaleString()}));return{balance:Number(s.reduce((e,a)=>e+("topup"===a.type?a.amount:-a.amount),0).toFixed(2)),recent:s}}function o(){let{userId:e,email:a,profile:s}=(0,c.A)(),[n,d]=(0,r.useState)(0),[o,m]=(0,r.useState)([]);return(0,r.useEffect)(()=>{e&&u(e).then(e=>{d(e.balance),m(e.recent)})},[e]),(0,l.jsx)(t.A,{role:"passenger",children:(0,l.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,l.jsxs)("div",{className:"card p-6 space-y-3",children:[(0,l.jsxs)("h2",{className:"text-xl font-semibold",children:["Hola ",a]}),(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:["Rol: ",(0,l.jsx)("b",{children:null==s?void 0:s.role})]}),(0,l.jsxs)("div",{className:"text-2xl font-bold",children:["Saldo: S/ ",n.toFixed(2)]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,l.jsx)(i(),{className:"btn w-full",href:"/user/pay",children:"Pagar Pasaje (QR)"}),(0,l.jsx)(i(),{className:"btn-outline w-full",href:"/user/recharge",children:"Recargar Saldo"})]})]}),(0,l.jsxs)("div",{className:"card p-6",children:[(0,l.jsx)("h3",{className:"font-semibold mb-3",children:"Actividad reciente"}),(0,l.jsx)("ul",{className:"space-y-2 text-sm",children:o.map(e=>(0,l.jsxs)("li",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:e.label}),(0,l.jsxs)("span",{className:"topup"===e.type?"text-green-600":"text-red-600",children:["topup"===e.type?"+":"-","S/ ",e.amount.toFixed(2)]})]},e.id))})]}),(0,l.jsx)(i(),{className:"btn-outline",href:"/user/nearby",children:"Ver unidades cercanas"})]})})}},4091:(e,a,s)=>{Promise.resolve().then(s.bind(s,1046))},9410:(e,a,s)=>{"use strict";s.d(a,{N:()=>l});let l=(0,s(5835).createBrowserClient)("https://exyxexamvwfvwxjjfqpl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4eXhleGFtdndmdnd4ampmcXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc5MzEsImV4cCI6MjA3NDgyMzkzMX0.JW0haLRNKznqB0C5zMx9wF7_u6RTZQsD6WwgqpHHVIU")},9661:(e,a,s)=>{"use strict";s.d(a,{A:()=>c,AuthProvider:()=>i});var l=s(4248),r=s(4564),t=s(9410);let n=(0,r.createContext)(null);function i(e){let{children:a}=e,[s,i]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),[u,o]=(0,r.useState)(null),[m,p]=(0,r.useState)(!0),h=async(e,a)=>{let{data:s}=await t.N.from("profiles").select("*").eq("id",e).maybeSingle();if(s)return void o(s);let{data:l,error:r}=await t.N.rpc("ensure_profile",{p_id:e,p_email:null!=a?a:""});if(r){console.error("[ensure_profile rpc] error",r),o(null);return}o(null!=l?l:null)};(0,r.useEffect)(()=>{(async()=>{var e,a,s,l,r,n;let{data:c}=await t.N.auth.getSession(),u=null!=(r=null==(a=c.session)||null==(e=a.user)?void 0:e.id)?r:null,o=null!=(n=null==(l=c.session)||null==(s=l.user)?void 0:s.email)?n:null;i(u),d(o),u&&await h(u,o),p(!1)})();let{data:e}=t.N.auth.onAuthStateChange(async(e,a)=>{var s,l,r,t;let n=null!=(r=null==a||null==(s=a.user)?void 0:s.id)?r:null,c=null!=(t=null==a||null==(l=a.user)?void 0:l.email)?t:null;i(n),d(c),n?await h(n,c):o(null)});return()=>{e.subscription.unsubscribe()}},[]);let x=async()=>{await t.N.auth.signOut()};return(0,l.jsx)(n.Provider,{value:{userId:s,email:c,profile:u,loading:m,signOut:x},children:a})}let c=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("AuthProvider missing");return e}}},e=>{e.O(0,[835,642,647,516,358],()=>e(e.s=4091)),_N_E=e.O()}]);