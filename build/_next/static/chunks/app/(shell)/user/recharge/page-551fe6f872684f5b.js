(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[418],{451:(e,l,t)=>{"use strict";t.d(l,{A:()=>u});var a=t(4248),r=t(7642),s=t.n(r),n=t(9661),i=t(8650),c=t(5523);function u(e){let{role:l,children:t}=e,{loading:r,error:u,userId:o,profile:d}=(0,n.A)();return r?(0,a.jsx)("div",{className:"min-h-[50vh] flex items-center justify-center",children:(0,a.jsx)(i.A,{className:"h-6 w-6 animate-spin"})}):u?(0,a.jsxs)("div",{className:"card p-6 text-center space-y-2",children:[(0,a.jsxs)("div",{className:"text-sm text-red-600",children:["Error: ",u]}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Refresca e int\xe9ntalo nuevamente."})]}):o?(null==d?void 0:d.role)!==l?(0,a.jsxs)("div",{className:"card p-6 text-center space-y-2",children:[(0,a.jsx)(c.A,{className:"h-6 w-6 mx-auto"}),(0,a.jsxs)("div",{className:"text-sm",children:["Acceso restringido. Requiere rol ",(0,a.jsx)("b",{children:l}),"."]})]}):(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsxs)("div",{className:"card p-6 text-center space-y-3",children:[(0,a.jsx)(c.A,{className:"h-6 w-6 mx-auto"}),(0,a.jsx)("div",{className:"text-sm",children:"Necesitas iniciar sesi\xf3n para acceder."}),(0,a.jsx)(s(),{className:"btn",href:"/login",children:"Ir a Login"})]})}},2786:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>u});var a=t(4248),r=t(4564),s=t(451),n=t(9410),i=t(9661),c=t(8299);function u(){let{userId:e}=(0,i.A)(),[l,t]=(0,r.useState)(10),[u,o]=(0,r.useState)("4111 1111 1111 1111"),[d,m]=(0,r.useState)("12/28"),[h,p]=(0,r.useState)("123"),[x,N]=(0,r.useState)(!1),v=async t=>{if(t.preventDefault(),e){N(!0);try{var a,r;let t=crypto.randomUUID(),{data:s,error:i}=await n.N.rpc("topup_balance",{p_passenger_id:e,p_amount:Number(l),p_idempotency_key:t});if(i)throw i;c.Ay.success("Recarga exitosa. Nuevo saldo: S/ ".concat(Number(null!=(r=null==s||null==(a=s[0])?void 0:a.new_balance)?r:0).toFixed(2))),history.back()}catch(e){c.Ay.error(e.message)}finally{N(!1)}}};return(0,a.jsx)(s.A,{role:"passenger",children:(0,a.jsxs)("form",{onSubmit:v,className:"max-w-md mx-auto card p-6 space-y-3",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Recargar Saldo"}),(0,a.jsxs)("label",{className:"text-sm",children:["Monto (S/)",(0,a.jsx)("input",{type:"number",step:"0.5",min:.5,className:"mt-1 w-full rounded-xl border px-3 py-2",value:l,onChange:e=>t(Number(e.target.value))})]}),(0,a.jsxs)("label",{className:"text-sm",children:["N\xfamero de Tarjeta",(0,a.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2",value:u,onChange:e=>o(e.target.value)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("label",{className:"text-sm",children:["Vencimiento",(0,a.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2",value:d,onChange:e=>m(e.target.value)})]}),(0,a.jsxs)("label",{className:"text-sm",children:["CVV",(0,a.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2",value:h,onChange:e=>p(e.target.value)})]})]}),(0,a.jsx)("button",{className:"btn w-full",disabled:x,children:x?"Procesandoâ€¦":"Confirmar Recarga"})]})})}},5112:(e,l,t)=>{"use strict";t.d(l,{A:()=>c});var a=t(4564);let r=e=>{let l=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,l,t)=>t?t.toUpperCase():l.toLowerCase());return l.charAt(0).toUpperCase()+l.slice(1)},s=function(){for(var e=arguments.length,l=Array(e),t=0;t<e;t++)l[t]=arguments[t];return l.filter((e,l,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===l).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,a.forwardRef)((e,l)=>{let{color:t="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:c,className:u="",children:o,iconNode:d,...m}=e;return(0,a.createElement)("svg",{ref:l,...n,width:r,height:r,stroke:t,strokeWidth:c?24*Number(i)/Number(r):i,className:s("lucide",u),...!o&&!(e=>{for(let l in e)if(l.startsWith("aria-")||"role"===l||"title"===l)return!0})(m)&&{"aria-hidden":"true"},...m},[...d.map(e=>{let[l,t]=e;return(0,a.createElement)(l,t)}),...Array.isArray(o)?o:[o]])}),c=(e,l)=>{let t=(0,a.forwardRef)((t,n)=>{let{className:c,...u}=t;return(0,a.createElement)(i,{ref:n,iconNode:l,className:s("lucide-".concat(r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),c),...u})});return t.displayName=r(e),t}},5523:(e,l,t)=>{"use strict";t.d(l,{A:()=>a});let a=(0,t(5112).A)("lock-keyhole",[["circle",{cx:"12",cy:"16",r:"1",key:"1au0dj"}],["rect",{x:"3",y:"10",width:"18",height:"12",rx:"2",key:"6s8ecr"}],["path",{d:"M7 10V7a5 5 0 0 1 10 0v3",key:"1pqi11"}]])},8283:(e,l,t)=>{Promise.resolve().then(t.bind(t,2786))},8650:(e,l,t)=>{"use strict";t.d(l,{A:()=>a});let a=(0,t(5112).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},9410:(e,l,t)=>{"use strict";t.d(l,{N:()=>a});let a=(0,t(5835).createBrowserClient)("https://exyxexamvwfvwxjjfqpl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4eXhleGFtdndmdnd4ampmcXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc5MzEsImV4cCI6MjA3NDgyMzkzMX0.JW0haLRNKznqB0C5zMx9wF7_u6RTZQsD6WwgqpHHVIU")},9661:(e,l,t)=>{"use strict";t.d(l,{A:()=>c,O:()=>i});var a=t(4248),r=t(4564),s=t(9410);let n=(0,r.createContext)(null);function i(e){let{children:l}=e,[t,i]=(0,r.useState)(null),[c,u]=(0,r.useState)(null),[o,d]=(0,r.useState)(null),[m,h]=(0,r.useState)(!0),[p,x]=(0,r.useState)(null),N=(0,r.useCallback)(async(e,l)=>{h(!0),x(null);try{var t;let{data:a,error:r}=await s.N.from("profiles").select("*").eq("id",e).maybeSingle();if(r&&"PGRST116"!==r.code&&console.warn("[profiles select]",r),a)return void d(a);let{data:n,error:i}=await s.N.rpc("ensure_profile",{p_id:e,p_email:null!=l?l:""});if(i)throw console.error("[ensure_profile]",i),Error("No se pudo crear/obtener el perfil");let{data:c,error:u}=await s.N.from("profiles").select("*").eq("id",e).maybeSingle();u&&console.warn("[profiles reselect]",u),d(null!=(t=null!=c?c:n)?t:null)}catch(e){d(null),x((null==e?void 0:e.message)||"Error de autenticaci\xf3n")}finally{h(!1)}},[]),v=(0,r.useCallback)(async()=>{var e,l;if(!t)return;let{data:{session:a}}=await s.N.auth.getSession();await N(t,null!=(l=null==a||null==(e=a.user)?void 0:e.email)?l:null)},[t,N]);(0,r.useEffect)(()=>{(async()=>{try{var e,l,t,a;h(!0);let{data:{session:r}}=await s.N.auth.getSession(),n=null!=(t=null==r||null==(e=r.user)?void 0:e.id)?t:null,c=null!=(a=null==r||null==(l=r.user)?void 0:l.email)?a:null;i(n),u(c),n?await N(n,c):h(!1)}catch(e){x((null==e?void 0:e.message)||"Error inicializando sesi\xf3n"),h(!1)}})();let{data:e}=s.N.auth.onAuthStateChange(async(e,l)=>{var t,a,r,s;let n=null!=(r=null==l||null==(t=l.user)?void 0:t.id)?r:null,c=null!=(s=null==l||null==(a=l.user)?void 0:a.email)?s:null;i(n),u(c),n?await N(n,c):(d(null),h(!1))});return()=>{e.subscription.unsubscribe()}},[N]);let f=async()=>{await s.N.auth.signOut(),i(null),u(null),d(null)};return(0,a.jsx)(n.Provider,{value:{userId:t,email:c,profile:o,loading:m,error:p,refreshProfile:v,signOut:f},children:l})}let c=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("AuthProvider missing");return e}}},e=>{e.O(0,[835,642,299,647,516,358],()=>e(e.s=8283)),_N_E=e.O()}]);