(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[418],{451:(e,a,l)=>{"use strict";l.d(a,{A:()=>t});var s=l(4248),r=l(9661);function t(e){let{role:a,children:l}=e,{userId:t,profile:n,loading:i}=(0,r.A)();return i?(0,s.jsx)("div",{className:"card p-6",children:"Cargando…"}):t?n?"passenger"===a&&"passenger"!==n.role?(0,s.jsx)("div",{className:"card p-6",children:"Solo para pasajeros."}):"driver"===a&&"driver"!==n.role?(0,s.jsx)("div",{className:"card p-6",children:"Solo para conductores."}):"admin"===a&&"admin"!==n.role?(0,s.jsx)("div",{className:"card p-6",children:"Solo admins."}):(0,s.jsx)(s.Fragment,{children:l}):(0,s.jsx)("div",{className:"card p-6",children:"Perfil no encontrado."}):(0,s.jsx)("div",{className:"card p-6",children:"Inicia sesi\xf3n."})}},2786:(e,a,l)=>{"use strict";l.r(a),l.d(a,{default:()=>c});var s=l(4248),r=l(4564),t=l(451),n=l(9410),i=l(9661),u=l(8299);function c(){let{userId:e}=(0,i.A)(),[a,l]=(0,r.useState)(10),[c,d]=(0,r.useState)("4111 1111 1111 1111"),[o,m]=(0,r.useState)("12/28"),[p,x]=(0,r.useState)("123"),[h,v]=(0,r.useState)(!1),N=async l=>{if(l.preventDefault(),e){if(!a||a<=0)return u.Ay.error("Monto inv\xe1lido");v(!0);try{let{error:l}=await n.N.from("transactions").insert({type:"topup",passenger_id:e,amount:Number(a),meta:{method:"card",card_last4:c.slice(-4),exp:o}});if(l)throw l;u.Ay.success("Recarga exitosa")}catch(a){let e=a instanceof Error?a.message:String(a);u.Ay.error(e)}finally{v(!1)}}};return(0,s.jsx)(t.A,{role:"passenger",children:(0,s.jsxs)("form",{onSubmit:N,className:"max-w-md mx-auto card p-6 space-y-3",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Recargar Saldo"}),(0,s.jsxs)("label",{className:"text-sm",children:["Monto (S/)",(0,s.jsx)("input",{type:"number",step:"0.5",min:.5,className:"mt-1 w-full rounded-xl border px-3 py-2",value:a,onChange:e=>l(Number(e.target.value))})]}),(0,s.jsxs)("label",{className:"text-sm",children:["N\xfamero de Tarjeta",(0,s.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2",value:c,onChange:e=>d(e.target.value)})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("label",{className:"text-sm",children:["Vencimiento",(0,s.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2",value:o,onChange:e=>m(e.target.value)})]}),(0,s.jsxs)("label",{className:"text-sm",children:["CVV",(0,s.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2",value:p,onChange:e=>x(e.target.value)})]})]}),(0,s.jsx)("button",{className:"btn w-full",disabled:h,children:h?"Procesando…":"Confirmar Recarga"})]})})}},8283:(e,a,l)=>{Promise.resolve().then(l.bind(l,2786))},9410:(e,a,l)=>{"use strict";l.d(a,{N:()=>s});let s=(0,l(5835).createBrowserClient)("https://exyxexamvwfvwxjjfqpl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4eXhleGFtdndmdnd4ampmcXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc5MzEsImV4cCI6MjA3NDgyMzkzMX0.JW0haLRNKznqB0C5zMx9wF7_u6RTZQsD6WwgqpHHVIU")},9661:(e,a,l)=>{"use strict";l.d(a,{A:()=>u,AuthProvider:()=>i});var s=l(4248),r=l(4564),t=l(9410);let n=(0,r.createContext)(null);function i(e){let{children:a}=e,[l,i]=(0,r.useState)(null),[u,c]=(0,r.useState)(null),[d,o]=(0,r.useState)(null),[m,p]=(0,r.useState)(!0),x=async(e,a)=>{let{data:l}=await t.N.from("profiles").select("*").eq("id",e).maybeSingle();if(l)return void o(l);let{data:s,error:r}=await t.N.rpc("ensure_profile",{p_id:e,p_email:null!=a?a:""});if(r){console.error("[ensure_profile rpc] error",r),o(null);return}o(null!=s?s:null)};(0,r.useEffect)(()=>{(async()=>{var e,a,l,s,r,n;let{data:u}=await t.N.auth.getSession(),d=null!=(r=null==(a=u.session)||null==(e=a.user)?void 0:e.id)?r:null,o=null!=(n=null==(s=u.session)||null==(l=s.user)?void 0:l.email)?n:null;i(d),c(o),d&&await x(d,o),p(!1)})();let{data:e}=t.N.auth.onAuthStateChange(async(e,a)=>{var l,s,r,t;let n=null!=(r=null==a||null==(l=a.user)?void 0:l.id)?r:null,u=null!=(t=null==a||null==(s=a.user)?void 0:s.email)?t:null;i(n),c(u),n?await x(n,u):o(null)});return()=>{e.subscription.unsubscribe()}},[]);let h=async()=>{await t.N.auth.signOut()};return(0,s.jsx)(n.Provider,{value:{userId:l,email:u,profile:d,loading:m,signOut:h},children:a})}let u=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("AuthProvider missing");return e}}},e=>{e.O(0,[835,299,647,516,358],()=>e(e.s=8283)),_N_E=e.O()}]);