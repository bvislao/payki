(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[418],{451:(e,l,a)=>{"use strict";a.d(l,{A:()=>n});var s=a(4248),r=a(9661);function n(e){let{role:l,children:a}=e,{userId:n,profile:t,loading:i}=(0,r.A)();return i?(0,s.jsx)("div",{className:"card p-6",children:"Cargando…"}):n?t?"passenger"===l&&"passenger"!==t.role?(0,s.jsx)("div",{className:"card p-6",children:"Solo para pasajeros."}):"driver"===l&&"driver"!==t.role?(0,s.jsx)("div",{className:"card p-6",children:"Solo para conductores."}):"admin"===l&&"admin"!==t.role?(0,s.jsx)("div",{className:"card p-6",children:"Solo admins."}):(0,s.jsx)(s.Fragment,{children:a}):(0,s.jsx)("div",{className:"card p-6",children:"Perfil no encontrado."}):(0,s.jsx)("div",{className:"card p-6",children:"Inicia sesi\xf3n."})}},2786:(e,l,a)=>{"use strict";a.r(l),a.d(l,{default:()=>c});var s=a(4248),r=a(4564),n=a(451),t=a(9410),i=a(9661),u=a(8299);function c(){let{userId:e}=(0,i.A)(),[l,a]=(0,r.useState)(10),[c,d]=(0,r.useState)("4111 1111 1111 1111"),[o,m]=(0,r.useState)("12/28"),[p,x]=(0,r.useState)("123"),[h,v]=(0,r.useState)(!1),N=async a=>{if(a.preventDefault(),e){v(!0);try{var s,r;let a=crypto.randomUUID(),{data:n,error:i}=await t.N.rpc("topup_balance",{p_passenger_id:e,p_amount:Number(l),p_idempotency_key:a});if(i)throw i;u.Ay.success("Recarga exitosa. Nuevo saldo: S/ ".concat(Number(null!=(r=null==n||null==(s=n[0])?void 0:s.new_balance)?r:0).toFixed(2))),history.back()}catch(e){u.Ay.error(e.message)}finally{v(!1)}}};return(0,s.jsx)(n.A,{role:"passenger",children:(0,s.jsxs)("form",{onSubmit:N,className:"max-w-md mx-auto card p-6 space-y-3",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Recargar Saldo"}),(0,s.jsxs)("label",{className:"text-sm",children:["Monto (S/)",(0,s.jsx)("input",{type:"number",step:"0.5",min:.5,className:"mt-1 w-full rounded-xl border px-3 py-2",value:l,onChange:e=>a(Number(e.target.value))})]}),(0,s.jsxs)("label",{className:"text-sm",children:["N\xfamero de Tarjeta",(0,s.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2",value:c,onChange:e=>d(e.target.value)})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("label",{className:"text-sm",children:["Vencimiento",(0,s.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2",value:o,onChange:e=>m(e.target.value)})]}),(0,s.jsxs)("label",{className:"text-sm",children:["CVV",(0,s.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2",value:p,onChange:e=>x(e.target.value)})]})]}),(0,s.jsx)("button",{className:"btn w-full",disabled:h,children:h?"Procesando…":"Confirmar Recarga"})]})})}},8283:(e,l,a)=>{Promise.resolve().then(a.bind(a,2786))},9410:(e,l,a)=>{"use strict";a.d(l,{N:()=>s});let s=(0,a(5835).createBrowserClient)("https://exyxexamvwfvwxjjfqpl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4eXhleGFtdndmdnd4ampmcXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc5MzEsImV4cCI6MjA3NDgyMzkzMX0.JW0haLRNKznqB0C5zMx9wF7_u6RTZQsD6WwgqpHHVIU")},9661:(e,l,a)=>{"use strict";a.d(l,{A:()=>u,AuthProvider:()=>i});var s=a(4248),r=a(4564),n=a(9410);let t=(0,r.createContext)(null);function i(e){let{children:l}=e,[a,i]=(0,r.useState)(null),[u,c]=(0,r.useState)(null),[d,o]=(0,r.useState)(null),[m,p]=(0,r.useState)(!0),x=async(e,l)=>{let{data:a}=await n.N.from("profiles").select("*").eq("id",e).maybeSingle();if(a)return void o(a);let{data:s,error:r}=await n.N.rpc("ensure_profile",{p_id:e,p_email:null!=l?l:""});if(r){console.error("[ensure_profile rpc] error",r),o(null);return}o(null!=s?s:null)};(0,r.useEffect)(()=>{(async()=>{var e,l,a,s,r,t;let{data:u}=await n.N.auth.getSession(),d=null!=(r=null==(l=u.session)||null==(e=l.user)?void 0:e.id)?r:null,o=null!=(t=null==(s=u.session)||null==(a=s.user)?void 0:a.email)?t:null;i(d),c(o),d&&await x(d,o),p(!1)})();let{data:e}=n.N.auth.onAuthStateChange(async(e,l)=>{var a,s,r,n;let t=null!=(r=null==l||null==(a=l.user)?void 0:a.id)?r:null,u=null!=(n=null==l||null==(s=l.user)?void 0:s.email)?n:null;i(t),c(u),t?await x(t,u):o(null)});return()=>{e.subscription.unsubscribe()}},[]);let h=async()=>{await n.N.auth.signOut()};return(0,s.jsx)(t.Provider,{value:{userId:a,email:u,profile:d,loading:m,signOut:h},children:l})}let u=()=>{let e=(0,r.useContext)(t);if(!e)throw Error("AuthProvider missing");return e}}},e=>{e.O(0,[835,299,647,516,358],()=>e(e.s=8283)),_N_E=e.O()}]);