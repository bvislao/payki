(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[584],{451:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var l=r(4248),a=r(7642),s=r.n(a),i=r(9661),n=r(8650),c=r(5523);function d(e){let{role:t,children:r}=e,{loading:a,error:d,userId:u,profile:o}=(0,i.A)();return a?(0,l.jsx)("div",{className:"min-h-[50vh] flex items-center justify-center",children:(0,l.jsx)(n.A,{className:"h-6 w-6 animate-spin"})}):d?(0,l.jsxs)("div",{className:"card p-6 text-center space-y-2",children:[(0,l.jsxs)("div",{className:"text-sm text-red-600",children:["Error: ",d]}),(0,l.jsx)("div",{className:"text-xs text-gray-500",children:"Refresca e int\xe9ntalo nuevamente."})]}):u?(null==o?void 0:o.role)!==t?(0,l.jsxs)("div",{className:"card p-6 text-center space-y-2",children:[(0,l.jsx)(c.A,{className:"h-6 w-6 mx-auto"}),(0,l.jsxs)("div",{className:"text-sm",children:["Acceso restringido. Requiere rol ",(0,l.jsx)("b",{children:t}),"."]})]}):(0,l.jsx)(l.Fragment,{children:r}):(0,l.jsxs)("div",{className:"card p-6 text-center space-y-3",children:[(0,l.jsx)(c.A,{className:"h-6 w-6 mx-auto"}),(0,l.jsx)("div",{className:"text-sm",children:"Necesitas iniciar sesi\xf3n para acceder."}),(0,l.jsx)(s(),{className:"btn",href:"/login",children:"Ir a Login"})]})}},5112:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var l=r(4564);let a=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},s=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,l.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:n=2,absoluteStrokeWidth:c,className:d="",children:u,iconNode:o,...h}=e;return(0,l.createElement)("svg",{ref:t,...i,width:a,height:a,stroke:r,strokeWidth:c?24*Number(n)/Number(a):n,className:s("lucide",d),...!u&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(h)&&{"aria-hidden":"true"},...h},[...o.map(e=>{let[t,r]=e;return(0,l.createElement)(t,r)}),...Array.isArray(u)?u:[u]])}),c=(e,t)=>{let r=(0,l.forwardRef)((r,i)=>{let{className:c,...d}=r;return(0,l.createElement)(n,{ref:i,iconNode:t,className:s("lucide-".concat(a(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),c),...d})});return r.displayName=a(e),r}},5523:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(5112).A)("lock-keyhole",[["circle",{cx:"12",cy:"16",r:"1",key:"1au0dj"}],["rect",{x:"3",y:"10",width:"18",height:"12",rx:"2",key:"6s8ecr"}],["path",{d:"M7 10V7a5 5 0 0 1 10 0v3",key:"1pqi11"}]])},6037:(e,t,r)=>{Promise.resolve().then(r.bind(r,8230))},8230:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var l=r(4248),a=r(451);let s=(0,r(5112).A)("bus",[["path",{d:"M8 6v6",key:"18i7km"}],["path",{d:"M15 6v6",key:"1sg6z9"}],["path",{d:"M2 12h19.6",key:"de5uta"}],["path",{d:"M18 18h3s.5-1.7.8-2.8c.1-.4.2-.8.2-1.2 0-.4-.1-.8-.2-1.2l-1.4-5C20.1 6.8 19.1 6 18 6H4a2 2 0 0 0-2 2v10h3",key:"1wwztk"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M9 18h5",key:"lrx6i"}],["circle",{cx:"16",cy:"18",r:"2",key:"1v4tcr"}]]);function i(){return(0,l.jsx)(a.A,{role:"passenger",children:(0,l.jsxs)("div",{className:"card p-6 space-y-3",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold",children:"Unidades cercanas"}),(0,l.jsxs)("div",{className:"relative w-full h-72 rounded-2xl border bg-gray-100 dark:bg-gray-900 overflow-hidden",children:[(0,l.jsxs)("div",{className:"absolute -translate-x-1/2 -translate-y-1/2",style:{left:"".concat(50,"%"),top:"".concat(50,"%")},children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full bg-payki-600 border-2 border-white shadow"}),(0,l.jsx)("div",{className:"text-[10px] mt-1 text-gray-600",children:"T\xfa"})]}),[{id:"B-102",x:30,y:40},{id:"B-205",x:55,y:20},{id:"B-311",x:70,y:65}].map(e=>(0,l.jsxs)("div",{className:"absolute -translate-x-1/2 -translate-y-1/2",style:{left:"".concat(e.x,"%"),top:"".concat(e.y,"%")},children:[(0,l.jsx)(s,{className:"w-5 h-5"}),(0,l.jsx)("div",{className:"text-[10px] mt-1 text-gray-600",children:e.id})]},e.id))]})]})})}},8650:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(5112).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},9410:(e,t,r)=>{"use strict";r.d(t,{N:()=>l});let l=(0,r(5835).createBrowserClient)("https://exyxexamvwfvwxjjfqpl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4eXhleGFtdndmdnd4ampmcXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc5MzEsImV4cCI6MjA3NDgyMzkzMX0.JW0haLRNKznqB0C5zMx9wF7_u6RTZQsD6WwgqpHHVIU")},9661:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,O:()=>n});var l=r(4248),a=r(4564),s=r(9410);let i=(0,a.createContext)(null);function n(e){let{children:t}=e,[r,n]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),[u,o]=(0,a.useState)(null),[h,m]=(0,a.useState)(!0),[x,p]=(0,a.useState)(null),y=(0,a.useCallback)(async(e,t)=>{m(!0),p(null);try{var r;let{data:l,error:a}=await s.N.from("profiles").select("*").eq("id",e).maybeSingle();if(a&&"PGRST116"!==a.code&&console.warn("[profiles select]",a),l)return void o(l);let{data:i,error:n}=await s.N.rpc("ensure_profile",{p_id:e,p_email:null!=t?t:""});if(n)throw console.error("[ensure_profile]",n),Error("No se pudo crear/obtener el perfil");let{data:c,error:d}=await s.N.from("profiles").select("*").eq("id",e).maybeSingle();d&&console.warn("[profiles reselect]",d),o(null!=(r=null!=c?c:i)?r:null)}catch(e){o(null),p((null==e?void 0:e.message)||"Error de autenticaci\xf3n")}finally{m(!1)}},[]),v=(0,a.useCallback)(async()=>{var e,t;if(!r)return;let{data:{session:l}}=await s.N.auth.getSession();await y(r,null!=(t=null==l||null==(e=l.user)?void 0:e.email)?t:null)},[r,y]);(0,a.useEffect)(()=>{(async()=>{try{var e,t,r,l;m(!0);let{data:{session:a}}=await s.N.auth.getSession(),i=null!=(r=null==a||null==(e=a.user)?void 0:e.id)?r:null,c=null!=(l=null==a||null==(t=a.user)?void 0:t.email)?l:null;n(i),d(c),i?await y(i,c):m(!1)}catch(e){p((null==e?void 0:e.message)||"Error inicializando sesi\xf3n"),m(!1)}})();let{data:e}=s.N.auth.onAuthStateChange(async(e,t)=>{var r,l,a,s;let i=null!=(a=null==t||null==(r=t.user)?void 0:r.id)?a:null,c=null!=(s=null==t||null==(l=t.user)?void 0:l.email)?s:null;n(i),d(c),i?await y(i,c):(o(null),m(!1))});return()=>{e.subscription.unsubscribe()}},[y]);let f=async()=>{await s.N.auth.signOut(),n(null),d(null),o(null)};return(0,l.jsx)(i.Provider,{value:{userId:r,email:c,profile:u,loading:h,error:x,refreshProfile:v,signOut:f},children:t})}let c=()=>{let e=(0,a.useContext)(i);if(!e)throw Error("AuthProvider missing");return e}}},e=>{e.O(0,[835,642,647,516,358],()=>e(e.s=6037)),_N_E=e.O()}]);