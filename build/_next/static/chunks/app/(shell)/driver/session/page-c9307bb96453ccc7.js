(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[540],{1631:(e,s,a)=>{Promise.resolve().then(a.bind(a,7117))},3827:(e,s,a)=>{"use strict";a.d(s,{Provider:()=>x,B:()=>c,P:()=>m});var t=a(4248),l=a(4564);let r=[{id:"u1",name:"Mar\xeda L\xf3pez",balance:15.5}],n=[{id:"t1",type:"ride",label:"Viaje Corredor Azul",amount:-2.5,date:"2025-10-09 08:21"},{id:"t2",type:"topup",label:"Recarga tarjeta",amount:10,date:"2025-10-08 19:02"}],i=[{id:"b102",plate:"ABC-102",route:"Corredor Azul",driverId:"d1",status:"Activo",pos:{x:25,y:40}},{id:"b207",plate:"XYZ-207",route:"Corredor Rojo",driverId:"d2",status:"Activo",pos:{x:60,y:55}},{id:"b312",plate:"LMN-312",route:"Alimentador Norte",driverId:null,status:"Inactivo",pos:{x:75,y:20}}],d=[{id:"d1",name:"Juan P\xe9rez",unitId:"b102",onShift:!1},{id:"d2",name:"Ana Torres",unitId:"b207",onShift:!0},{id:"d3",name:"Luis Ramos",unitId:null,onShift:!1}];function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id",s=(0,l.useRef)(0);return(0,l.useCallback)(()=>{let a="".concat(e,"-").concat(s.current);return s.current+=1,a},[e])}let o=(0,l.createContext)(null);function x(e){let{children:s}=e,[a,c]=(0,l.useState)(r[0]),[x,m]=(0,l.useState)(n),u=(0,l.useRef)(i),[h,j]=(0,l.useState)(d),[v,b]=(0,l.useState)(null),N=(0,l.useCallback)(e=>{c(s=>({...s,balance:Number(e.toFixed(2))}))},[]),p=(0,l.useCallback)(e=>{m(s=>[e,...s].slice(0,20))},[]),g=(0,l.useCallback)(e=>{j(s=>{let a=s.find(s=>s.id===e)||s[0],t=u.current.find(e=>{var s;return e.id===(null!=(s=a.unitId)?s:u.current[0].id)})||u.current[0],l=t.route;return b({driverId:a.id,unitId:t.id,route:l,startedAt:new Date().toISOString(),fares:[{label:"General",amount:2.5},{label:"Universitario",amount:1.25},{label:"Escolar",amount:1}],transactions:[]}),s.map(e=>e.id===a.id?{...e,onShift:!0,unitId:t.id}:e)})},[]),f=(0,l.useCallback)(()=>{let e={total:0,count:0};return b(s=>(s&&(e.total=s.transactions.reduce((e,s)=>e+(s.amount>0?s.amount:0),0),e.count=s.transactions.length,j(e=>e.map(e=>e.id===s.driverId?{...e,onShift:!1}:e))),null)),e},[]),y=(0,l.useMemo)(()=>({user:a,activity:x,setBalance:N,addActivity:p,buses:u.current,drivers:h,driverSession:v,startShift:g,endShift:f}),[a,x,h,v,N,p,g,f]);return(0,t.jsx)(o.Provider,{value:y,children:s})}let m=()=>{let e=(0,l.useContext)(o);if(!e)throw Error("Store missing Provider");return e}},7117:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>h});var t=a(4248),l=a(4564),r=a(5519),n=a(3827),i=a(1360);function d(e){let{value:s}=e;return(0,t.jsx)("div",{className:"card p-4 grid place-items-center",children:(0,t.jsx)(i.X,{value:s,size:240,includeMargin:!0})})}var c=a(5994),o=a(8556),x=a(8114),m=a(9812),u=a(8029);function h(){let e=(0,r.useRouter)(),{driverSession:s,startShift:a,endShift:i,drivers:h}=(0,n.P)(),j=(0,n.B)("drvtx"),[v,b]=(0,l.useState)(null),N=(0,l.useMemo)(()=>{if(!s)return null;let e=s.transactions.reduce((e,s)=>e+s.amount,0),a=s.transactions.length;return{total:e,count:a,avgFare:a>0?e/a:0}},[s]);if(!s){let e=h.filter(e=>!e.onShift);return(0,t.jsx)("div",{className:"max-w-2xl mx-auto space-y-6",children:(0,t.jsxs)("div",{className:"card p-8 space-y-6",children:[(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto",children:(0,t.jsx)(c.A,{className:"w-8 h-8 text-blue-600"})}),(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Iniciar Jornada"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Selecciona un conductor para comenzar"})]}),(0,t.jsx)("div",{className:"space-y-3",children:e.map(e=>(0,t.jsx)("button",{className:"w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left",onClick:()=>a(e.id),children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold",children:e.name}),(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",e.id]})]}),(0,t.jsx)("div",{className:"text-blue-600 font-medium",children:"Iniciar â†’"})]})},e.id))})]})})}let{driverId:p,unitId:g,route:f,fares:y,transactions:w,startedAt:S}=s,A=h.find(e=>e.id===p),C=Math.floor((Date.now()-new Date(S).getTime())/1e3/60);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"card p-6",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(c.A,{className:"w-6 h-6 text-green-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:(null==A?void 0:A.name)||p}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Jornada Activa"})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(c.A,{className:"w-4 h-4 text-gray-400"}),(0,t.jsxs)("span",{children:["Unidad ",g]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(o.A,{className:"w-4 h-4 text-gray-400"}),(0,t.jsx)("span",{children:f})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(x.A,{className:"w-4 h-4 text-gray-400"}),(0,t.jsxs)("span",{children:[C," min"]})]})]})]}),(0,t.jsx)("button",{className:"btn btn-sm bg-red-500 hover:bg-red-600 text-white",onClick:()=>{let s=i();confirm("\xbfFinalizar jornada?\n\n"+"Pasajeros atendidos: ".concat(s.count,"\n")+"Total recaudado: S/ ".concat(s.total.toFixed(2),"\n")+"Duraci\xf3n: ".concat(C," minutos"))&&e.back()},children:"Finalizar"})]})}),N&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)("div",{className:"card p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Pasajeros"}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:N.count})]}),(0,t.jsx)(m.A,{className:"w-8 h-8 text-blue-500"})]})}),(0,t.jsx)("div",{className:"card p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Total Recaudado"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:["S/ ",N.total.toFixed(2)]})]}),(0,t.jsx)(u.A,{className:"w-8 h-8 text-green-500"})]})}),(0,t.jsx)("div",{className:"card p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Tarifa Promedio"}),(0,t.jsxs)("p",{className:"text-2xl font-bold",children:["S/ ",N.avgFare.toFixed(2)]})]}),(0,t.jsx)(u.A,{className:"w-8 h-8 text-purple-500"})]})})]}),(0,t.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"card p-6 space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Generar QR de Pago"}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:y.map(e=>(0,t.jsxs)("button",{className:"p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-center space-y-1",onClick:()=>((e,s)=>{let a=JSON.stringify({id:j(),amount:s,unitId:g,driverId:p,ts:Date.now(),label:e});b({label:e,amount:s,payload:a})})(e.label,e.amount),children:[(0,t.jsx)("div",{className:"text-xs text-gray-500 uppercase",children:e.label}),(0,t.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:["S/ ",e.amount.toFixed(2)]})]},e.label))})]}),(0,t.jsxs)("div",{className:"card p-6",children:[(0,t.jsx)("h3",{className:"font-semibold mb-4",children:"Historial de Transacciones"}),(0,t.jsx)("div",{className:"max-h-80 overflow-y-auto space-y-2",children:0===w.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(m.A,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-sm text-gray-400",children:"No hay transacciones a\xfan"}),(0,t.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Los pagos aparecer\xe1n aqu\xed"})]}):w.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-xs font-bold text-green-600",children:w.length-s}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-sm",children:e.label}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:e.date})]})]}),(0,t.jsxs)("span",{className:"text-green-600 font-semibold",children:["+S/ ",e.amount.toFixed(2)]})]},e.id))})]})]}),v&&(0,t.jsx)(d,{value:v.payload})]})}}},e=>{e.O(0,[354,647,516,358],()=>e(e.s=1631)),_N_E=e.O()}]);