(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[839],{451:(e,r,l)=>{"use strict";l.d(r,{A:()=>u});var t=l(4248),a=l(7642),s=l.n(a),n=l(9661),i=l(8650),c=l(5523);function u(e){let{role:r,children:l}=e,{loading:a,error:u,userId:o,profile:d}=(0,n.A)();return a?(0,t.jsx)("div",{className:"min-h-[50vh] flex items-center justify-center",children:(0,t.jsx)(i.A,{className:"h-6 w-6 animate-spin"})}):u?(0,t.jsxs)("div",{className:"card p-6 text-center space-y-2",children:[(0,t.jsxs)("div",{className:"text-sm text-red-600",children:["Error: ",u]}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"Refresca e int\xe9ntalo nuevamente."})]}):o?(null==d?void 0:d.role)!==r?(0,t.jsxs)("div",{className:"card p-6 text-center space-y-2",children:[(0,t.jsx)(c.A,{className:"h-6 w-6 mx-auto"}),(0,t.jsxs)("div",{className:"text-sm",children:["Acceso restringido. Requiere rol ",(0,t.jsx)("b",{children:r}),"."]})]}):(0,t.jsx)(t.Fragment,{children:l}):(0,t.jsxs)("div",{className:"card p-6 text-center space-y-3",children:[(0,t.jsx)(c.A,{className:"h-6 w-6 mx-auto"}),(0,t.jsx)("div",{className:"text-sm",children:"Necesitas iniciar sesi\xf3n para acceder."}),(0,t.jsx)(s(),{className:"btn",href:"/login",children:"Ir a Login"})]})}},2948:(e,r,l)=>{Promise.resolve().then(l.bind(l,5631))},5112:(e,r,l)=>{"use strict";l.d(r,{A:()=>c});var t=l(4564);let a=e=>{let r=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,l)=>l?l.toUpperCase():r.toLowerCase());return r.charAt(0).toUpperCase()+r.slice(1)},s=function(){for(var e=arguments.length,r=Array(e),l=0;l<e;l++)r[l]=arguments[l];return r.filter((e,r,l)=>!!e&&""!==e.trim()&&l.indexOf(e)===r).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,t.forwardRef)((e,r)=>{let{color:l="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:c,className:u="",children:o,iconNode:d,...h}=e;return(0,t.createElement)("svg",{ref:r,...n,width:a,height:a,stroke:l,strokeWidth:c?24*Number(i)/Number(a):i,className:s("lucide",u),...!o&&!(e=>{for(let r in e)if(r.startsWith("aria-")||"role"===r||"title"===r)return!0})(h)&&{"aria-hidden":"true"},...h},[...d.map(e=>{let[r,l]=e;return(0,t.createElement)(r,l)}),...Array.isArray(o)?o:[o]])}),c=(e,r)=>{let l=(0,t.forwardRef)((l,n)=>{let{className:c,...u}=l;return(0,t.createElement)(i,{ref:n,iconNode:r,className:s("lucide-".concat(a(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),c),...u})});return l.displayName=a(e),l}},5523:(e,r,l)=>{"use strict";l.d(r,{A:()=>t});let t=(0,l(5112).A)("lock-keyhole",[["circle",{cx:"12",cy:"16",r:"1",key:"1au0dj"}],["rect",{x:"3",y:"10",width:"18",height:"12",rx:"2",key:"6s8ecr"}],["path",{d:"M7 10V7a5 5 0 0 1 10 0v3",key:"1pqi11"}]])},5631:(e,r,l)=>{"use strict";l.r(r),l.d(r,{default:()=>c});var t=l(4248),a=l(7642),s=l.n(a),n=l(451),i=l(9661);function c(){let{profile:e}=(0,i.A)();return(0,t.jsx)(n.A,{role:"driver",children:(0,t.jsxs)("div",{className:"max-w-xl mx-auto card p-6 space-y-4",children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold",children:["Conductor â€” ",null==e?void 0:e.full_name]}),(0,t.jsx)(s(),{className:"btn w-full",href:"/driver/session",children:"Ir a Jornada"})]})})}},8650:(e,r,l)=>{"use strict";l.d(r,{A:()=>t});let t=(0,l(5112).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},9410:(e,r,l)=>{"use strict";l.d(r,{N:()=>t});let t=(0,l(5835).createBrowserClient)("https://exyxexamvwfvwxjjfqpl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4eXhleGFtdndmdnd4ampmcXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc5MzEsImV4cCI6MjA3NDgyMzkzMX0.JW0haLRNKznqB0C5zMx9wF7_u6RTZQsD6WwgqpHHVIU")},9661:(e,r,l)=>{"use strict";l.d(r,{A:()=>c,O:()=>i});var t=l(4248),a=l(4564),s=l(9410);let n=(0,a.createContext)(null);function i(e){let{children:r}=e,[l,i]=(0,a.useState)(null),[c,u]=(0,a.useState)(null),[o,d]=(0,a.useState)(null),[h,m]=(0,a.useState)(!0),[x,p]=(0,a.useState)(null),f=(0,a.useCallback)(async(e,r)=>{m(!0),p(null);try{var l;let{data:t,error:a}=await s.N.from("profiles").select("*").eq("id",e).maybeSingle();if(a&&"PGRST116"!==a.code&&console.warn("[profiles select]",a),t)return void d(t);let{data:n,error:i}=await s.N.rpc("ensure_profile",{p_id:e,p_email:null!=r?r:""});if(i)throw console.error("[ensure_profile]",i),Error("No se pudo crear/obtener el perfil");let{data:c,error:u}=await s.N.from("profiles").select("*").eq("id",e).maybeSingle();u&&console.warn("[profiles reselect]",u),d(null!=(l=null!=c?c:n)?l:null)}catch(e){d(null),p((null==e?void 0:e.message)||"Error de autenticaci\xf3n")}finally{m(!1)}},[]),v=(0,a.useCallback)(async()=>{var e,r;if(!l)return;let{data:{session:t}}=await s.N.auth.getSession();await f(l,null!=(r=null==t||null==(e=t.user)?void 0:e.email)?r:null)},[l,f]);(0,a.useEffect)(()=>{(async()=>{try{var e,r,l,t;m(!0);let{data:{session:a}}=await s.N.auth.getSession(),n=null!=(l=null==a||null==(e=a.user)?void 0:e.id)?l:null,c=null!=(t=null==a||null==(r=a.user)?void 0:r.email)?t:null;i(n),u(c),n?await f(n,c):m(!1)}catch(e){p((null==e?void 0:e.message)||"Error inicializando sesi\xf3n"),m(!1)}})();let{data:e}=s.N.auth.onAuthStateChange(async(e,r)=>{var l,t,a,s;let n=null!=(a=null==r||null==(l=r.user)?void 0:l.id)?a:null,c=null!=(s=null==r||null==(t=r.user)?void 0:t.email)?s:null;i(n),u(c),n?await f(n,c):(d(null),m(!1))});return()=>{e.subscription.unsubscribe()}},[f]);let w=async()=>{await s.N.auth.signOut(),i(null),u(null),d(null)};return(0,t.jsx)(n.Provider,{value:{userId:l,email:c,profile:o,loading:h,error:x,refreshProfile:v,signOut:w},children:r})}let c=()=>{let e=(0,a.useContext)(n);if(!e)throw Error("AuthProvider missing");return e}}},e=>{e.O(0,[835,642,647,516,358],()=>e(e.s=2948)),_N_E=e.O()}]);