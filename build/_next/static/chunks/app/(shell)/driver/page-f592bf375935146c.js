(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[839],{451:(e,l,t)=>{"use strict";t.d(l,{A:()=>s});var r=t(4248),n=t(9661),u=t(5519);function s(e){let{role:l,children:t}=e,{loading:s,userId:a,profile:i}=(0,n.A)(),o=(0,u.useRouter)();return s?(0,r.jsx)("div",{className:"p-6 text-sm text-gray-500",children:"Cargando…"}):a?(null==i?void 0:i.role)!==l?(0,r.jsx)("div",{className:"p-6",children:"Acceso denegado"}):(0,r.jsx)(r.Fragment,{children:t}):(o.push("/login"),null)}},2948:(e,l,t)=>{Promise.resolve().then(t.bind(t,5631))},5519:(e,l,t)=>{"use strict";var r=t(2455);t.o(r,"usePathname")&&t.d(l,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(l,{useRouter:function(){return r.useRouter}})},5631:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>i});var r=t(4248),n=t(7642),u=t.n(n),s=t(451),a=t(9661);function i(){let{profile:e}=(0,a.A)();return(0,r.jsx)(s.A,{role:"driver",children:(0,r.jsxs)("div",{className:"max-w-xl mx-auto card p-6 space-y-4",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold",children:["Conductor — ",null==e?void 0:e.full_name]}),(0,r.jsx)(u(),{className:"btn w-full",href:"/driver/session",children:"Ir a Jornada"})]})})}},9410:(e,l,t)=>{"use strict";t.d(l,{N:()=>r});let r=(0,t(5835).createBrowserClient)("https://exyxexamvwfvwxjjfqpl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4eXhleGFtdndmdnd4ampmcXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc5MzEsImV4cCI6MjA3NDgyMzkzMX0.JW0haLRNKznqB0C5zMx9wF7_u6RTZQsD6WwgqpHHVIU")},9661:(e,l,t)=>{"use strict";t.d(l,{A:()=>i,O:()=>a});var r=t(4248),n=t(4564),u=t(9410);let s=(0,n.createContext)(null);function a(e){let{children:l}=e,[t,a]=(0,n.useState)(null),[i,o]=(0,n.useState)(null),[c,d]=(0,n.useState)(null),[h,m]=(0,n.useState)(!0),f=async(e,l)=>{try{let{data:t}=await u.N.from("profiles").select("*").eq("id",e).maybeSingle();if(t)return void d(t);let{data:r,error:n}=await u.N.rpc("ensure_profile",{p_id:e,p_email:null!=l?l:""});if(n){console.error("[ensure_profile] error",n),d(null);return}d(r)}catch(e){console.error("[fetchOrCreate] ",e),d(null)}};(0,n.useEffect)(()=>{let e=!0;(async()=>{var l,t,r,n;let{data:{session:s}}=await u.N.auth.getSession(),i=null!=(r=null==s||null==(l=s.user)?void 0:l.id)?r:null,c=null!=(n=null==s||null==(t=s.user)?void 0:t.email)?n:null;e&&(a(i),o(c),i&&await f(i,c),e&&m(!1))})();let{data:l}=u.N.auth.onAuthStateChange(async(e,l)=>{var t,r,n,u;let s=null!=(n=null==l||null==(t=l.user)?void 0:t.id)?n:null,i=null!=(u=null==l||null==(r=l.user)?void 0:r.email)?u:null;a(s),o(i),s?await f(s,i):d(null)});return()=>{e=!1,l.subscription.unsubscribe()}},[]);let v=async()=>{await u.N.auth.signOut()};return(0,r.jsx)(s.Provider,{value:{userId:t,email:i,profile:c,loading:h,signOut:v},children:l})}let i=()=>{let e=(0,n.useContext)(s);if(!e)throw Error("AuthProvider missing");return e}}},e=>{e.O(0,[835,642,647,516,358],()=>e(e.s=2948)),_N_E=e.O()}]);