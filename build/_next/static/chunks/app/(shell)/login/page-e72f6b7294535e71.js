(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[502],{105:(e,l,t)=>{Promise.resolve().then(t.bind(t,3934))},3934:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>o});var a=t(4248),s=t(4564),n=t(9410),r=t(9661),i=t(7642),u=t.n(i),c=t(5519);function o(){let[e,l]=(0,s.useState)("demo@payki.pe"),[t,i]=(0,s.useState)("demo1234"),[o,d]=(0,s.useState)("login"),[m,x]=(0,s.useState)(!1),{userId:h,profile:p,loading:f,signOut:N}=(0,r.A)(),b=(0,c.useRouter)();(0,s.useEffect)(()=>{!f&&h&&p&&b.replace("/")},[f,h,p,b]);let g=async l=>{l.preventDefault(),x(!0);try{if("login"===o){let{error:l}=await n.N.auth.signInWithPassword({email:e,password:t});if(l)throw l}else{let{data:l,error:a}=await n.N.auth.signUp({email:e,password:t});if(a)throw a;alert("Cuenta creada. Revisa tu correo si se requiere confirmaci\xf3n y luego inicia sesi\xf3n."),d("login")}}catch(e){var a;alert(null!=(a=e.message)?a:"Error")}finally{x(!1)}};return f?(0,a.jsx)("div",{className:"max-w-md mx-auto card p-6 text-sm text-gray-500",children:"Cargando…"}):h&&!p?(0,a.jsxs)("div",{className:"max-w-md mx-auto card p-6 space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Sesi\xf3n activa"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Esperando perfil…"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"btn",onClick:()=>b.push("/"),children:"Ir al inicio"}),(0,a.jsx)("button",{className:"btn-outline",onClick:N,children:"Cerrar sesi\xf3n"})]})]}):(0,a.jsxs)("form",{onSubmit:g,className:"max-w-md mx-auto card p-6 space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"login"===o?"Iniciar sesi\xf3n":"Crear cuenta"}),(0,a.jsxs)("label",{className:"block text-sm",children:["Email",(0,a.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2",type:"email",value:e,onChange:e=>l(e.target.value)})]}),(0,a.jsxs)("label",{className:"block text-sm",children:["Contrase\xf1a",(0,a.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2",type:"password",value:t,onChange:e=>i(e.target.value)})]}),(0,a.jsx)("button",{className:"btn w-full",disabled:m,type:"submit",children:m?"Procesando…":"login"===o?"Entrar":"Registrarme"}),(0,a.jsx)("div",{className:"text-xs text-center",children:"login"===o?(0,a.jsxs)(a.Fragment,{children:["\xbfNo tienes cuenta? ",(0,a.jsx)("button",{type:"button",className:"underline",onClick:()=>d("signup"),children:"Reg\xedstrate"})]}):(0,a.jsxs)(a.Fragment,{children:["\xbfYa tienes cuenta? ",(0,a.jsx)("button",{type:"button",className:"underline",onClick:()=>d("login"),children:"Inicia sesi\xf3n"})]})}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(u(),{className:"text-xs underline",href:"/",children:"Volver"})})]})}},5519:(e,l,t)=>{"use strict";var a=t(2455);t.o(a,"usePathname")&&t.d(l,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(l,{useRouter:function(){return a.useRouter}})},9410:(e,l,t)=>{"use strict";t.d(l,{N:()=>a});let a=(0,t(5835).createBrowserClient)("https://exyxexamvwfvwxjjfqpl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4eXhleGFtdndmdnd4ampmcXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc5MzEsImV4cCI6MjA3NDgyMzkzMX0.JW0haLRNKznqB0C5zMx9wF7_u6RTZQsD6WwgqpHHVIU")},9661:(e,l,t)=>{"use strict";t.d(l,{A:()=>u,O:()=>i});var a=t(4248),s=t(4564),n=t(9410);let r=(0,s.createContext)(null);function i(e){let{children:l}=e,[t,i]=(0,s.useState)(null),[u,c]=(0,s.useState)(null),[o,d]=(0,s.useState)(null),[m,x]=(0,s.useState)(!0),[h,p]=(0,s.useState)(null),f=(0,s.useCallback)(async(e,l)=>{x(!0),p(null);try{var t;let{data:a,error:s}=await n.N.from("profiles").select("*").eq("id",e).maybeSingle();if(s&&"PGRST116"!==s.code&&console.warn("[profiles select]",s),a)return void d(a);let{data:r,error:i}=await n.N.rpc("ensure_profile",{p_id:e,p_email:null!=l?l:""});if(i)throw console.error("[ensure_profile]",i),Error("No se pudo crear/obtener el perfil");let{data:u,error:c}=await n.N.from("profiles").select("*").eq("id",e).maybeSingle();c&&console.warn("[profiles reselect]",c),d(null!=(t=null!=u?u:r)?t:null)}catch(e){d(null),p((null==e?void 0:e.message)||"Error de autenticaci\xf3n")}finally{x(!1)}},[]),N=(0,s.useCallback)(async()=>{var e,l;if(!t)return;let{data:{session:a}}=await n.N.auth.getSession();await f(t,null!=(l=null==a||null==(e=a.user)?void 0:e.email)?l:null)},[t,f]);(0,s.useEffect)(()=>{(async()=>{try{var e,l,t,a;x(!0);let{data:{session:s}}=await n.N.auth.getSession(),r=null!=(t=null==s||null==(e=s.user)?void 0:e.id)?t:null,u=null!=(a=null==s||null==(l=s.user)?void 0:l.email)?a:null;i(r),c(u),r?await f(r,u):x(!1)}catch(e){p((null==e?void 0:e.message)||"Error inicializando sesi\xf3n"),x(!1)}})();let{data:e}=n.N.auth.onAuthStateChange(async(e,l)=>{var t,a,s,n;let r=null!=(s=null==l||null==(t=l.user)?void 0:t.id)?s:null,u=null!=(n=null==l||null==(a=l.user)?void 0:a.email)?n:null;i(r),c(u),r?await f(r,u):(d(null),x(!1))});return()=>{e.subscription.unsubscribe()}},[f]);let b=async()=>{await n.N.auth.signOut(),i(null),c(null),d(null)};return(0,a.jsx)(r.Provider,{value:{userId:t,email:u,profile:o,loading:m,error:h,refreshProfile:N,signOut:b},children:l})}let u=()=>{let e=(0,s.useContext)(r);if(!e)throw Error("AuthProvider missing");return e}}},e=>{e.O(0,[835,642,647,516,358],()=>e(e.s=105)),_N_E=e.O()}]);