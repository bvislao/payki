(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[502],{105:(e,l,s)=>{Promise.resolve().then(s.bind(s,1858))},1858:(e,l,s)=>{"use strict";s.r(l),s.d(l,{default:()=>c});var t=s(4248),n=s(4564),a=s(9410),i=s(9661),r=s(7642),u=s.n(r),o=s(2455);function c(){let[e,l]=(0,n.useState)("demo@payki.pe"),[s,r]=(0,n.useState)("demo1234"),[c,d]=(0,n.useState)("login"),[m,h]=(0,n.useState)(!1),{userId:x,profile:p,signOut:b}=(0,i.A)(),g=(0,o.useRouter)(),N=async l=>{l.preventDefault(),h(!0);try{if("login"===c){let{error:l}=await a.N.auth.signInWithPassword({email:e,password:s});if(l)throw l;g.push("/")}else{var t;let{data:l,error:n}=await a.N.auth.signUp({email:e,password:s});if(n)throw n;let i=null==(t=l.user)?void 0:t.id;i&&await a.N.from("profiles").insert({id:i,full_name:e.split("@")[0],role:"passenger",passenger_sector:"normal",benefit:"none"}),alert("Cuenta creada. Ahora puedes iniciar sesi\xf3n."),d("login")}}catch(e){alert(e instanceof Error?e.message:String(e))}finally{h(!1)}};return x?(0,t.jsxs)("div",{className:"max-w-md mx-auto card p-6 space-y-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Sesi\xf3n activa"}),(0,t.jsxs)("p",{className:"text-sm",children:["Hola ",null==p?void 0:p.full_name,"! (",(0,t.jsx)("b",{children:null==p?void 0:p.role}),")"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{className:"btn",onClick:()=>g.push("/"),children:"Ir al inicio"}),(0,t.jsx)("button",{className:"btn-outline",onClick:b,children:"Cerrar sesi\xf3n"})]})]}):(0,t.jsxs)("form",{onSubmit:N,className:"max-w-md mx-auto card p-6 space-y-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"login"===c?"Iniciar sesi\xf3n":"Crear cuenta"}),(0,t.jsxs)("label",{className:"block text-sm",children:["Email",(0,t.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-900",type:"email",value:e,onChange:e=>l(e.target.value)})]}),(0,t.jsxs)("label",{className:"block text-sm",children:["Contrase\xf1a",(0,t.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-900",type:"password",value:s,onChange:e=>r(e.target.value)})]}),(0,t.jsx)("button",{className:"btn w-full",disabled:m,type:"submit",children:m?"Procesando...":"login"===c?"Entrar":"Registrarme"}),(0,t.jsx)("div",{className:"text-xs text-center",children:"login"===c?(0,t.jsxs)(t.Fragment,{children:["\xbfNo tienes cuenta?"," ",(0,t.jsx)("button",{type:"button",className:"underline",onClick:()=>d("signup"),children:"Reg\xedstrate"})]}):(0,t.jsxs)(t.Fragment,{children:["\xbfYa tienes cuenta?"," ",(0,t.jsx)("button",{type:"button",className:"underline",onClick:()=>d("login"),children:"Inicia sesi\xf3n"})]})}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)(u(),{className:"text-xs underline",href:"/",children:"Volver"})})]})}},9410:(e,l,s)=>{"use strict";s.d(l,{N:()=>t});let t=(0,s(5835).createBrowserClient)("https://exyxexamvwfvwxjjfqpl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4eXhleGFtdndmdnd4ampmcXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc5MzEsImV4cCI6MjA3NDgyMzkzMX0.JW0haLRNKznqB0C5zMx9wF7_u6RTZQsD6WwgqpHHVIU")},9661:(e,l,s)=>{"use strict";s.d(l,{A:()=>u,AuthProvider:()=>r});var t=s(4248),n=s(4564),a=s(9410);let i=(0,n.createContext)(null);function r(e){let{children:l}=e,[s,r]=(0,n.useState)(null),[u,o]=(0,n.useState)(null),[c,d]=(0,n.useState)(null),[m,h]=(0,n.useState)(!0),x=async(e,l)=>{let{data:s}=await a.N.from("profiles").select("*").eq("id",e).maybeSingle();if(s)return void d(s);let{data:t,error:n}=await a.N.rpc("ensure_profile",{p_id:e,p_email:null!=l?l:""});if(n){console.error("[ensure_profile rpc] error",n),d(null);return}d(null!=t?t:null)};(0,n.useEffect)(()=>{(async()=>{var e,l,s,t,n,i;let{data:u}=await a.N.auth.getSession(),c=null!=(n=null==(l=u.session)||null==(e=l.user)?void 0:e.id)?n:null,d=null!=(i=null==(t=u.session)||null==(s=t.user)?void 0:s.email)?i:null;r(c),o(d),c&&await x(c,d),h(!1)})();let{data:e}=a.N.auth.onAuthStateChange(async(e,l)=>{var s,t,n,a;let i=null!=(n=null==l||null==(s=l.user)?void 0:s.id)?n:null,u=null!=(a=null==l||null==(t=l.user)?void 0:t.email)?a:null;r(i),o(u),i?await x(i,u):d(null)});return()=>{e.subscription.unsubscribe()}},[]);let p=async()=>{await a.N.auth.signOut()};return(0,t.jsx)(i.Provider,{value:{userId:s,email:u,profile:c,loading:m,signOut:p},children:l})}let u=()=>{let e=(0,n.useContext)(i);if(!e)throw Error("AuthProvider missing");return e}}},e=>{e.O(0,[835,642,647,516,358],()=>e(e.s=105)),_N_E=e.O()}]);