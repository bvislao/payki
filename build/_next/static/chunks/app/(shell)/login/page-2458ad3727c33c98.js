(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[502],{105:(e,s,l)=>{Promise.resolve().then(l.bind(l,3934))},3934:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>d});var t=l(4248),n=l(4564),a=l(9410),i=l(9661),r=l(7642),u=l.n(r),c=l(5519),o=l(8299);function d(){let[e,s]=(0,n.useState)(""),[l,r]=(0,n.useState)(""),[d,m]=(0,n.useState)("login"),[h,x]=(0,n.useState)(!1),{userId:p,profile:b,signOut:f}=(0,i.A)(),g=(0,c.useRouter)(),N=async s=>{s.preventDefault(),x(!0);try{if("login"===d){let{error:s}=await a.N.auth.signInWithPassword({email:e,password:l});if(s)throw s;o.Ay.success("Sesi\xf3n iniciada!"),g.push("/")}else{var t;let{data:s,error:n}=await a.N.auth.signUp({email:e,password:l});if(n)throw n;let i=null==(t=s.user)?void 0:t.id;i&&await a.N.from("profiles").insert({id:i,full_name:e.split("@")[0],role:"passenger",passenger_sector:"normal",benefit:"none"}),o.Ay.success("Revisa tu email para el link de activaci\xf3n."),m("login")}}catch(s){let e=s instanceof Error?s.message:String(s);o.Ay.error(e)}finally{x(!1)}};return p?(0,t.jsxs)("div",{className:"max-w-md mx-auto card p-6 space-y-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Sesi\xf3n activa"}),(0,t.jsxs)("p",{className:"text-sm",children:["Hola ",null==b?void 0:b.full_name,"! (",(0,t.jsx)("b",{children:null==b?void 0:b.role}),")"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{className:"btn",onClick:()=>g.push("/"),children:"Ir al inicio"}),(0,t.jsx)("button",{className:"btn-outline",onClick:f,children:"Cerrar sesi\xf3n"})]})]}):(0,t.jsxs)("form",{onSubmit:N,className:"max-w-md mx-auto card p-6 space-y-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"login"===d?"Iniciar sesi\xf3n":"Crear cuenta"}),(0,t.jsxs)("label",{className:"block text-sm",children:["Email",(0,t.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-900",type:"email",value:e,onChange:e=>s(e.target.value)})]}),(0,t.jsxs)("label",{className:"block text-sm",children:["Contrase\xf1a",(0,t.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-900",type:"password",value:l,onChange:e=>r(e.target.value)})]}),(0,t.jsx)("button",{className:"btn w-full",disabled:h,type:"submit",children:h?"Procesando...":"login"===d?"Entrar":"Registrarme"}),(0,t.jsx)("div",{className:"text-xs text-center",children:"login"===d?(0,t.jsxs)(t.Fragment,{children:["\xbfNo tienes cuenta?"," ",(0,t.jsx)("button",{type:"button",className:"underline",onClick:()=>m("signup"),children:"Reg\xedstrate"})]}):(0,t.jsxs)(t.Fragment,{children:["\xbfYa tienes cuenta?"," ",(0,t.jsx)("button",{type:"button",className:"underline",onClick:()=>m("login"),children:"Inicia sesi\xf3n"})]})}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)(u(),{className:"text-xs underline",href:"/",children:"Volver"})})]})}},5519:(e,s,l)=>{"use strict";var t=l(2455);l.o(t,"usePathname")&&l.d(s,{usePathname:function(){return t.usePathname}}),l.o(t,"useRouter")&&l.d(s,{useRouter:function(){return t.useRouter}})},9410:(e,s,l)=>{"use strict";l.d(s,{N:()=>t});let t=(0,l(5835).createBrowserClient)("https://exyxexamvwfvwxjjfqpl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4eXhleGFtdndmdnd4ampmcXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc5MzEsImV4cCI6MjA3NDgyMzkzMX0.JW0haLRNKznqB0C5zMx9wF7_u6RTZQsD6WwgqpHHVIU")},9661:(e,s,l)=>{"use strict";l.d(s,{A:()=>u,AuthProvider:()=>r});var t=l(4248),n=l(4564),a=l(9410);let i=(0,n.createContext)(null);function r(e){let{children:s}=e,[l,r]=(0,n.useState)(null),[u,c]=(0,n.useState)(null),[o,d]=(0,n.useState)(null),[m,h]=(0,n.useState)(!0),x=async(e,s)=>{let{data:l}=await a.N.from("profiles").select("*").eq("id",e).maybeSingle();if(l)return void d(l);let{data:t,error:n}=await a.N.rpc("ensure_profile",{p_id:e,p_email:null!=s?s:""});if(n){console.error("[ensure_profile rpc] error",n),d(null);return}d(null!=t?t:null)};(0,n.useEffect)(()=>{(async()=>{var e,s,l,t,n,i;let{data:u}=await a.N.auth.getSession(),o=null!=(n=null==(s=u.session)||null==(e=s.user)?void 0:e.id)?n:null,d=null!=(i=null==(t=u.session)||null==(l=t.user)?void 0:l.email)?i:null;r(o),c(d),o&&await x(o,d),h(!1)})();let{data:e}=a.N.auth.onAuthStateChange(async(e,s)=>{var l,t,n,a;let i=null!=(n=null==s||null==(l=s.user)?void 0:l.id)?n:null,u=null!=(a=null==s||null==(t=s.user)?void 0:t.email)?a:null;r(i),c(u),i?await x(i,u):d(null)});return()=>{e.subscription.unsubscribe()}},[]);let p=async()=>{await a.N.auth.signOut()};return(0,t.jsx)(i.Provider,{value:{userId:l,email:u,profile:o,loading:m,signOut:p},children:s})}let u=()=>{let e=(0,n.useContext)(i);if(!e)throw Error("AuthProvider missing");return e}}},e=>{e.O(0,[835,299,642,647,516,358],()=>e(e.s=105)),_N_E=e.O()}]);