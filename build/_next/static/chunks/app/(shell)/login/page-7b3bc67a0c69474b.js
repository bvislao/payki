(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[502],{105:(e,t,l)=>{Promise.resolve().then(l.bind(l,3934))},3934:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>o});var s=l(4248),a=l(4564),n=l(9410),r=l(9661),i=l(7642),u=l.n(i),c=l(5519);function o(){let[e,t]=(0,a.useState)("demo@payki.pe"),[l,i]=(0,a.useState)("demo1234"),[o,d]=(0,a.useState)("login"),[m,x]=(0,a.useState)(!1),{userId:h,profile:p,loading:f,signOut:N}=(0,r.A)(),b=(0,c.useRouter)();(0,a.useEffect)(()=>{!f&&h&&p&&b.replace("/")},[f,h,p,b]);let g=async t=>{t.preventDefault(),x(!0);try{if("login"===o){let{error:t}=await n.N.auth.signInWithPassword({email:e,password:l});if(t)throw t}else{let{data:t,error:s}=await n.N.auth.signUp({email:e,password:l});if(s)throw s;alert("Cuenta creada. Revisa tu correo si se requiere confirmaci\xf3n y luego inicia sesi\xf3n."),d("login")}}catch(e){var s;alert(null!=(s=e.message)?s:"Error")}finally{x(!1)}};return f?(0,s.jsx)("div",{className:"max-w-md mx-auto card p-6 text-sm text-gray-500",children:"Cargando…"}):h&&!p?(0,s.jsxs)("div",{className:"max-w-md mx-auto card p-6 space-y-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Sesi\xf3n activa"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Esperando perfil…"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{className:"btn",onClick:()=>b.push("/"),children:"Ir al inicio"}),(0,s.jsx)("button",{className:"btn-outline",onClick:N,children:"Cerrar sesi\xf3n"})]})]}):(0,s.jsxs)("form",{onSubmit:g,className:"max-w-md mx-auto card p-6 space-y-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"login"===o?"Iniciar sesi\xf3n":"Crear cuenta"}),(0,s.jsxs)("label",{className:"block text-sm",children:["Email",(0,s.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2",type:"email",value:e,onChange:e=>t(e.target.value)})]}),(0,s.jsxs)("label",{className:"block text-sm",children:["Contrase\xf1a",(0,s.jsx)("input",{className:"mt-1 w-full rounded-xl border px-3 py-2",type:"password",value:l,onChange:e=>i(e.target.value)})]}),(0,s.jsx)("button",{className:"btn w-full",disabled:m,type:"submit",children:m?"Procesando…":"login"===o?"Entrar":"Registrarme"}),(0,s.jsx)("div",{className:"text-xs text-center",children:"login"===o?(0,s.jsxs)(s.Fragment,{children:["\xbfNo tienes cuenta? ",(0,s.jsx)("button",{type:"button",className:"underline",onClick:()=>d("signup"),children:"Reg\xedstrate"})]}):(0,s.jsxs)(s.Fragment,{children:["\xbfYa tienes cuenta? ",(0,s.jsx)("button",{type:"button",className:"underline",onClick:()=>d("login"),children:"Inicia sesi\xf3n"})]})}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)(u(),{className:"text-xs underline",href:"/",children:"Volver"})})]})}},5519:(e,t,l)=>{"use strict";var s=l(2455);l.o(s,"usePathname")&&l.d(t,{usePathname:function(){return s.usePathname}}),l.o(s,"useRouter")&&l.d(t,{useRouter:function(){return s.useRouter}})},9410:(e,t,l)=>{"use strict";l.d(t,{N:()=>s});let s=(0,l(5835).createBrowserClient)("https://exyxexamvwfvwxjjfqpl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4eXhleGFtdndmdnd4ampmcXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc5MzEsImV4cCI6MjA3NDgyMzkzMX0.JW0haLRNKznqB0C5zMx9wF7_u6RTZQsD6WwgqpHHVIU")},9661:(e,t,l)=>{"use strict";l.d(t,{A:()=>u,O:()=>i});var s=l(4248),a=l(4564),n=l(9410);let r=(0,a.createContext)(null);function i(e){let{children:t}=e,[l,i]=(0,a.useState)(null),[u,c]=(0,a.useState)(null),[o,d]=(0,a.useState)(null),[m,x]=(0,a.useState)(!0),h=async(e,t)=>{try{let{data:l}=await n.N.from("profiles").select("*").eq("id",e).maybeSingle();if(l)return void d(l);let{data:s,error:a}=await n.N.rpc("ensure_profile",{p_id:e,p_email:null!=t?t:""});if(a){console.error("[ensure_profile] error",a),d(null);return}d(s)}catch(e){console.error("[fetchOrCreate] ",e),d(null)}};(0,a.useEffect)(()=>{let e=!0;(async()=>{var t,l,s,a;let{data:{session:r}}=await n.N.auth.getSession(),u=null!=(s=null==r||null==(t=r.user)?void 0:t.id)?s:null,o=null!=(a=null==r||null==(l=r.user)?void 0:l.email)?a:null;e&&(i(u),c(o),u&&await h(u,o),e&&x(!1))})();let{data:t}=n.N.auth.onAuthStateChange(async(e,t)=>{var l,s,a,n;let r=null!=(a=null==t||null==(l=t.user)?void 0:l.id)?a:null,u=null!=(n=null==t||null==(s=t.user)?void 0:s.email)?n:null;i(r),c(u),r?await h(r,u):d(null)});return()=>{e=!1,t.subscription.unsubscribe()}},[]);let p=async()=>{await n.N.auth.signOut()};return(0,s.jsx)(r.Provider,{value:{userId:l,email:u,profile:o,loading:m,signOut:p},children:t})}let u=()=>{let e=(0,a.useContext)(r);if(!e)throw Error("AuthProvider missing");return e}}},e=>{e.O(0,[835,642,647,516,358],()=>e(e.s=105)),_N_E=e.O()}]);