(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{39:(e,t,r)=>{Promise.resolve().then(r.bind(r,9523)),Promise.resolve().then(r.bind(r,4927)),Promise.resolve().then(r.bind(r,8787)),Promise.resolve().then(r.bind(r,1235)),Promise.resolve().then(r.bind(r,9661)),Promise.resolve().then(r.t.bind(r,5763,23))},1235:(e,t,r)=>{"use strict";r.d(t,{default:()=>i});var n=r(4248),a=r(8299);function i(){return(0,n.jsx)(a.l$,{position:"top-center",toastOptions:{duration:3e3,style:{fontSize:"0.9rem",borderRadius:"0.75rem",background:"var(--toast-bg)",color:"var(--toast-fg)"},success:{iconTheme:{primary:"#10b981",secondary:"white"}},error:{iconTheme:{primary:"#ef4444",secondary:"white"}}}})}},4927:(e,t,r)=>{"use strict";r.d(t,{default:()=>p});var n=r(4248),a=r(7642),i=r.n(a),s=r(9661),o=r(4564),l=r(9410);async function u(){return"serviceWorker"in navigator?await navigator.serviceWorker.register("/sw.js"):null}async function c(e,t){if(!("serviceWorker"in navigator)||!("PushManager"in window))throw Error("Push no soportado en este navegador");if("granted"!==await Notification.requestPermission())throw Error("Permiso de notificaciones denegado");let r=await navigator.serviceWorker.ready,n=await r.pushManager.getSubscription();if(n){let e=n.toJSON().keys;return await t({endpoint:n.endpoint,p256dh:e.p256dh,auth:e.auth}),!0}let a=await r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){if(!e)throw Error("VAPID public key is empty/undefined");let t=e.trim().replace(/^"+|"+$/g,"").replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/"),r=t.length%4;r&&(t+="=".repeat(4-r));let n="";try{n=atob(t)}catch(e){throw Error("Invalid VAPID public key (not Base64/Base64URL).")}let a=new Uint8Array(n.length);for(let e=0;e<n.length;e++)a[e]=n.charCodeAt(e);return a}(e)}),i=a.toJSON().keys;return await t({endpoint:a.endpoint,p256dh:i.p256dh,auth:i.auth}),!0}var d=r(8299);function h(){let{userId:e}=(0,s.A)(),[t,r]=(0,o.useState)(!1),a="BMoOo9WNPPHr_bTAO1pfRuPNEG1yBAG1iP34WSS-B-AlgIQ_mBh680P8PF5p5NCB4qzo5jpHo6EUHU1vmaCnAog",i=async()=>{let t=function(){var e;let t=[],r=window.isSecureContext||"https:"===location.protocol;r||"localhost"===location.hostname||t.push("El sitio no est\xe1 en HTTPS.");let n="serviceWorker"in navigator;n||t.push("Este navegador no soporta Service Worker.");let a="PushManager"in window;a||t.push("Este navegador no soporta la API de Push.");let i=null==(e=Notification)?void 0:e.permission;"denied"===i&&t.push("Las notificaciones est\xe1n bloqueadas para este sitio.");let s=navigator.userAgent||"",o=/iPad|iPhone|iPod/.test(s)&&!("MSStream"in window),l=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone;return o&&!l&&t.push("En iOS debes instalar la PWA en la pantalla de inicio para recibir push."),{ok:0===t.length,reasons:t,info:{isSecure:r,hasSW:n,hasPush:a,perm:i,isIOS:o,isStandalone:l}}}();if(!t.ok)return void(0,d.Ay)("Navegador no soportado para Web Push:\n- "+t.reasons.join("\n- "));if(!e)return(0,d.Ay)("Inicia sesi\xf3n primero");if(!a)return(0,d.Ay)("Falta NEXT_PUBLIC_VAPID_PUBLIC_KEY");try{r(!0),await u(),await c(a,async t=>{let{endpoint:r,p256dh:n,auth:a}=t;await l.N.from("push_subscriptions").upsert({user_id:e,endpoint:r,p256dh:n,auth:a,user_agent:navigator.userAgent},{onConflict:"endpoint"})}),(0,d.Ay)("Notificaciones activadas")}catch(e){d.Ay.error(e instanceof Error?e.message:String(e))}finally{r(!1)}};return(0,n.jsx)("button",{className:"btn-outline",onClick:i,disabled:t,children:t?"ACt…":"Act Not"})}function p(){let{userId:e,email:t,profile:r,signOut:a}=(0,s.A)();return(0,n.jsxs)("nav",{className:"container flex items-center justify-between h-14",children:[(0,n.jsx)(i(),{href:"/","aria-label":"Inicio",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("img",{src:"/logo-bg.svg",alt:"PAYKI",className:"h-7 w-auto"}),(0,n.jsx)("span",{className:"sr-only",children:"PAYKI"})]})}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[e&&(0,n.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:["Hola ",(0,n.jsx)("b",{children:t}),"! (",(0,n.jsx)("b",{children:null==r?void 0:r.role}),")"]}),!!e&&(0,n.jsx)(h,{}),e?(0,n.jsx)("button",{className:"btn-outline",onClick:async()=>{await a(),window.location.href="/"},children:"Cerrar sesi\xf3n"}):(0,n.jsx)(i(),{className:"btn",href:"/login",children:"Login"})]})]})}},5763:()=>{},8787:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});var n=r(4564);function a(){return(0,n.useEffect)(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js",{scope:"/"}).catch(console.error)},[]),null}},9410:(e,t,r)=>{"use strict";r.d(t,{N:()=>n});let n=(0,r(5835).createBrowserClient)("https://exyxexamvwfvwxjjfqpl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4eXhleGFtdndmdnd4ampmcXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc5MzEsImV4cCI6MjA3NDgyMzkzMX0.JW0haLRNKznqB0C5zMx9wF7_u6RTZQsD6WwgqpHHVIU")},9523:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});var n=r(4248),a=r(7642),i=r.n(a);function s(){return(0,n.jsxs)("footer",{className:"container py-8 text-xs text-center text-gray-500",children:["Hecho con ",(0,n.jsx)("span",{"aria-label":"amor",title:"amor",children:"❤"})," —"," ",(0,n.jsx)(i(),{href:"https://github.com/bvislao/payki",className:"underline hover:opacity-80",target:"_blank",rel:"noopener noreferrer",children:"C\xf3digo GitHub"}),"  "," \xa9 ",new Date().getFullYear()," PAYKI"]})}},9661:(e,t,r)=>{"use strict";r.d(t,{A:()=>l,AuthProvider:()=>o});var n=r(4248),a=r(4564),i=r(9410);let s=(0,a.createContext)(null);function o(e){let{children:t}=e,[r,o]=(0,a.useState)(null),[l,u]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),[h,p]=(0,a.useState)(!0),g=async(e,t)=>{let{data:r}=await i.N.from("profiles").select("*").eq("id",e).maybeSingle();if(r)return void d(r);let{data:n,error:a}=await i.N.rpc("ensure_profile",{p_id:e,p_email:null!=t?t:""});if(a){console.error("[ensure_profile rpc] error",a),d(null);return}d(null!=n?n:null)};(0,a.useEffect)(()=>{(async()=>{var e,t,r,n,a,s;let{data:l}=await i.N.auth.getSession(),c=null!=(a=null==(t=l.session)||null==(e=t.user)?void 0:e.id)?a:null,d=null!=(s=null==(n=l.session)||null==(r=n.user)?void 0:r.email)?s:null;o(c),u(d),c&&await g(c,d),p(!1)})();let{data:e}=i.N.auth.onAuthStateChange(async(e,t)=>{var r,n,a,i;let s=null!=(a=null==t||null==(r=t.user)?void 0:r.id)?a:null,l=null!=(i=null==t||null==(n=t.user)?void 0:n.email)?i:null;o(s),u(l),s?await g(s,l):d(null)});return()=>{e.subscription.unsubscribe()}},[]);let v=async()=>{await i.N.auth.signOut()};return(0,n.jsx)(s.Provider,{value:{userId:r,email:l,profile:c,loading:h,signOut:v},children:t})}let l=()=>{let e=(0,a.useContext)(s);if(!e)throw Error("AuthProvider missing");return e}}},e=>{e.O(0,[360,835,299,642,647,516,358],()=>e(e.s=39)),_N_E=e.O()}]);